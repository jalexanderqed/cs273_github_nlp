  Use Yield macro to make it a little more portable between platforms.

Looks good to me. Waiting for the CI to finish.

@siying Ping

